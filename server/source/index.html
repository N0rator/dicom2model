<html>
<head>

    <style>

        #wrapper{
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        #file-catcher{
            display: flex;
            width: fit-content;
        }

    </style>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        let socket = io();

        window.onload = function() {

            let fileInput = document.getElementById('file-input'),
                fileCatcher = document.getElementById('file-catcher');

            let files = [];

            fileInput.addEventListener('change', (event)=>{
                files = [];
                for(let i = 0; i < fileInput.files.length; i++){
                    files.push(fileInput.files[i]);
                }
            });

            fileCatcher.addEventListener('submit', uploadFiles);

            socket.on('end uploading', endUploading);

            function endUploading(req){
                alert(req.result);
            }

            function uploadFiles(event) {
                event.preventDefault();

                let filesInfo = files.map((file)=>{
                    return {
                        name: file.name,
                        size: file.size
                    }
                });

                socket.emit('start uploading', filesInfo);

                files.forEach(sendFile);
            }

            function sendFile(file){
                let fileReader = new FileReader();
                fileReader.onloadend = (event) => {
                    socket.emit('upload file', {name: file.name, data: fileReader.result});
                };
                fileReader.readAsArrayBuffer(file);
            }

        }
    </script>
</head>
<body>
<div id="wrapper">
    <form id="file-catcher">
        <input type="file" id="file-input" multiple/>
        <button type="submit">Upload</button>
    </form>
</div>
</body>
</html>